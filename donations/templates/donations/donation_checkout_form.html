{% extends "base.html" %}

{% block title %}Donations Checkout| Ceanapse{% endblock %}

{% block content %}
<section class="donation-section">
  <div class="donation-container">
    <div class="donation-header">
      <h1 class="donation-title">Make a Donation Towards </h1>
      <p class="donation-subtitle">{{ project.name }}</p>
      <p class="donation-subtitle">Support ocean conservation and make a difference today.</p>
    </div>
    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'error' %}
                <p style="color:firebrick;">{{message}}</p>
            {% endif %}
        {% endfor %}
    {% endif %}
    <div class="project-container">
        <div class="projects">
            <!-- <img class="img" src="{{project.image}}" alt=""> -->
            <p>{{project.name}}</p>
            <p>Description: {{project.description}}</p>
            <form class="donation-form" id="donation-form" method="post" action="{% url 'donations:donation-checkout' project.id %}">
                {% csrf_token %}
                <div class="form-group">
                <label for="amount" class="form-label">Donation Amount <span class="required">*</span></label>
                <div class="amount-input-wrapper">
                <span class="amount-currency">KES</span>
                <input type="number" id="amount" name="amount" class="form-input form-input--amount" placeholder="0.00" step="0.01" min="0.01" required />
                </div>
                <span class="form-error" id="amount-error"></span>
                </div>
                <div class="amount-suggestions">
                  <button type="button" class="amount-btn" data-amount="500">KES 500</button>
                  <button type="button" class="amount-btn" data-amount="1000">KES 1,000</button>
                  <button type="button" class="amount-btn" data-amount="5000">KES 5,000</button>
                  <button type="button" class="amount-btn" data-amount="10000">KES 10,000</button>
                </div>
                </div>
                
                <div class="form-actions">
                <button type="submit" class="btn btn--primary" id="submit-btn">
                  Proceed to Donate
                  <span class="btn-text">Proceed to Donate</span>
                  <span class="btn-loader" id="btn-loader" style="display: none;">
                    <span class="loader"></span>
                  </span> 
                </button>
                <a href="{% url 'projects:ceanapse-home' %}" class="btn btn--secondary">Cancel</a>
                </div>
            </form>
        </div>  
      </div>



  
  </div>
</section> 
{% endblock %}

{% block extra_scripts %}
<script>
  // Amount suggestion buttons
  document.querySelectorAll('.amount-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const amount = this.getAttribute('data-amount');
      document.getElementById('amount').value = amount;
      
      // Update active state
      document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
    });
  });

  // Form validation
  const form = document.getElementById('donation-form');
  const submitBtn = document.getElementById('submit-btn');
  const btnLoader = document.getElementById('btn-loader');
  const btnText = submitBtn.querySelector('.btn-text');
// Helper function to get CSRF token
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

</script>
{% endblock %}

